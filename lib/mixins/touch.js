"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return _default;
    }
});
var _easy = require("easy");
var _position = /*#__PURE__*/ _interop_require_default(require("../position"));
var _velocity = /*#__PURE__*/ _interop_require_default(require("../velocity"));
var _customEventTypes = require("../customEventTypes");
var _constants = require("../constants");
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function enableTouch() {
    var startPosition = null;
    this.updateState({
        startPosition: startPosition
    });
    this.onMouseDown(this.mouseDownHandler);
    this.onMouseMove(this.mouseMoveHandler);
    _easy.window.onMouseUp(this.mouseUpHandler, this);
    this.onTouchStart(this.touchStartHandler);
    this.onTouchMove(this.touchMoveHandler);
    this.onTouchEnd(this.touchEndHandler);
}
function disableTouch() {
    this.offMouseDown(this.mouseDownHandler);
    this.offMouseMove(this.mouseMoveHandler);
    _easy.window.offMouseUp(this.mouseUpHandler, this);
    this.offTouchStart(this.touchStartHandler);
    this.offTouchMove(this.touchMoveHandler);
    this.offTouchEnd(this.touchEndHandler);
}
function onCustomTap(tapCustomHandler, element) {
    var customEventType = _customEventTypes.TAP_CUSTOM_EVENT_TYPE, customHandler = tapCustomHandler; ///
    this.onCustomEvent(customEventType, customHandler, element);
}
function offCustomTap(tapCustomHandler, element) {
    var customEventType = _customEventTypes.TAP_CUSTOM_EVENT_TYPE, customHandler = tapCustomHandler; ///
    this.offCustomEvent(customEventType, customHandler, element);
}
function onCustomSwipeLeft(swipeLeftCustomHandler, element) {
    var customEventType = _customEventTypes.SWIPE_LEFT_CUSTOM_EVENT_TYPE, customHandler = swipeLeftCustomHandler; ///
    this.onCustomEvent(customEventType, customHandler, element);
}
function offCustomSwipeLeft(swipeLeftCustomHandler, element) {
    var customEventType = _customEventTypes.SWIPE_LEFT_CUSTOM_EVENT_TYPE, customHandler = swipeLeftCustomHandler; ///
    this.offCustomEvent(customEventType, customHandler, element);
}
function onCustomSwipeRight(swipeRightCustomHandler, element) {
    var customEventType = _customEventTypes.SWIPE_RIGHT_CUSTOM_EVENT_TYPE, customHandler = swipeRightCustomHandler; ///
    this.onCustomEvent(customEventType, customHandler, element);
}
function offCustomSwipeRight(swipeRightCustomHandler, element) {
    var customEventType = _customEventTypes.SWIPE_RIGHT_CUSTOM_EVENT_TYPE, customHandler = swipeRightCustomHandler; ///
    this.offCustomEvent(customEventType, customHandler, element);
}
function getStartPosition() {
    var startPosition = this.getState().startPosition;
    return startPosition;
}
function setStartPosition(startPosition) {
    this.updateState({
        startPosition: startPosition
    });
}
function touchStartHandler(event, element) {
    this.startHandler(event, element, function(event) {
        var touchEvent = event, position = _position.default.fromTouchEvent(touchEvent);
        return position;
    });
}
function mouseDownHandler(event, element) {
    this.startHandler(event, element, function(event) {
        var mouseEvent = event, position = _position.default.fromMouseEvent(mouseEvent);
        return position;
    });
}
function touchMoveHandler(event, element) {
    this.moveHandler(event, element, function(event) {
        var touchEvent = event, position = _position.default.fromTouchEvent(touchEvent);
        return position;
    });
}
function mouseMoveHandler(event, element) {
    this.moveHandler(event, element, function(event) {
        var mouseEvent = event, position = _position.default.fromMouseEvent(mouseEvent);
        return position;
    });
}
function touchEndHandler(event, element) {
    this.endHandler(event, element, function(event) {
        var touchEvent = event, position = _position.default.fromTouchEvent(touchEvent);
        return position;
    });
}
function mouseUpHandler(event, element) {
    this.endHandler(event, element, function(event) {
        var mouseEvent = event, position = _position.default.fromMouseEvent(mouseEvent);
        return position;
    });
}
function startHandler(event, element, positionFromEvent) {
    var position = positionFromEvent(event), startPosition = position; ///
    this.setStartPosition(startPosition);
}
function moveHandler(event, element, positionFromEvent) {
    var startPosition = this.getStartPosition();
    if (startPosition !== null) {
        var position = positionFromEvent(event);
        if (position !== null) {
            var positionMatchesStartPosition = position.match(startPosition);
            if (positionMatchesStartPosition) {
                var velocity = _velocity.default.fromPositionAndStartPosition(position, startPosition), speed = velocity.getSpeed();
                if (speed > _constants.MINIMUM_SWIPE_SPEED) {
                    var absoluteDirection = velocity.getAbsoluteDirection();
                    if (absoluteDirection < _constants.MAXIMUM_SWIPE_ABSOLUTE_DIRECTION) {
                        var customEventType = _customEventTypes.SWIPE_RIGHT_CUSTOM_EVENT_TYPE;
                        this.callCustomHandlers(customEventType, event, element);
                    }
                    if (_constants.ONE_HUNDRED_AND_EIGHTY - absoluteDirection < _constants.MAXIMUM_SWIPE_ABSOLUTE_DIRECTION) {
                        var customEventType1 = _customEventTypes.SWIPE_LEFT_CUSTOM_EVENT_TYPE;
                        this.callCustomHandlers(customEventType1, event, element);
                    }
                }
            }
        }
    }
}
function endHandler(event, element, positionFromEvent) {
    var startPosition;
    startPosition = this.getStartPosition();
    if (startPosition !== null) {
        var position = positionFromEvent(event);
        if (position !== null) {
            var positionMatchesStartPosition = position.match(startPosition);
            if (positionMatchesStartPosition) {
                var velocity = _velocity.default.fromPositionAndStartPosition(position, startPosition), speed = velocity.getSpeed();
                if (speed === 0) {
                    var time = velocity.getTime();
                    if (time < _constants.MAXIMUM_TAP_TIME) {
                        var customEventType = _customEventTypes.TAP_CUSTOM_EVENT_TYPE;
                        this.callCustomHandlers(customEventType, event, element);
                    }
                }
            }
        }
    }
}
var customEventMixins = {
    enableTouch: enableTouch,
    disableTouch: disableTouch,
    onCustomTap: onCustomTap,
    offCustomTap: offCustomTap,
    onCustomSwipeLeft: onCustomSwipeLeft,
    offCustomSwipeLeft: offCustomSwipeLeft,
    onCustomSwipeRight: onCustomSwipeRight,
    offCustomSwipeRight: offCustomSwipeRight,
    getStartPosition: getStartPosition,
    setStartPosition: setStartPosition,
    touchStartHandler: touchStartHandler,
    mouseDownHandler: mouseDownHandler,
    touchMoveHandler: touchMoveHandler,
    mouseMoveHandler: mouseMoveHandler,
    touchEndHandler: touchEndHandler,
    mouseUpHandler: mouseUpHandler,
    startHandler: startHandler,
    moveHandler: moveHandler,
    endHandler: endHandler
};
var _default = customEventMixins;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9taXhpbnMvdG91Y2guanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB7IHdpbmRvdyB9IGZyb20gXCJlYXN5XCI7XG5cbmltcG9ydCBQb3NpdGlvbiBmcm9tIFwiLi4vcG9zaXRpb25cIjtcbmltcG9ydCBWZWxvY2l0eSBmcm9tIFwiLi4vdmVsb2NpdHlcIjtcblxuaW1wb3J0IHsgVEFQX0NVU1RPTV9FVkVOVF9UWVBFLCBTV0lQRV9MRUZUX0NVU1RPTV9FVkVOVF9UWVBFLCBTV0lQRV9SSUdIVF9DVVNUT01fRVZFTlRfVFlQRSB9IGZyb20gXCIuLi9jdXN0b21FdmVudFR5cGVzXCI7XG5pbXBvcnQgeyBNQVhJTVVNX1RBUF9USU1FLCBNSU5JTVVNX1NXSVBFX1NQRUVELCBPTkVfSFVORFJFRF9BTkRfRUlHSFRZLCBNQVhJTVVNX1NXSVBFX0FCU09MVVRFX0RJUkVDVElPTiB9IGZyb20gXCIuLi9jb25zdGFudHNcIjtcblxuZnVuY3Rpb24gZW5hYmxlVG91Y2goKSB7XG4gIGNvbnN0IHN0YXJ0UG9zaXRpb24gPSBudWxsO1xuXG4gIHRoaXMudXBkYXRlU3RhdGUoe1xuICAgIHN0YXJ0UG9zaXRpb25cbiAgfSk7XG5cbiAgdGhpcy5vbk1vdXNlRG93bih0aGlzLm1vdXNlRG93bkhhbmRsZXIpO1xuICB0aGlzLm9uTW91c2VNb3ZlKHRoaXMubW91c2VNb3ZlSGFuZGxlcik7XG5cbiAgd2luZG93Lm9uTW91c2VVcCh0aGlzLm1vdXNlVXBIYW5kbGVyLCB0aGlzKTtcblxuICB0aGlzLm9uVG91Y2hTdGFydCh0aGlzLnRvdWNoU3RhcnRIYW5kbGVyKTtcbiAgdGhpcy5vblRvdWNoTW92ZSh0aGlzLnRvdWNoTW92ZUhhbmRsZXIpO1xuICB0aGlzLm9uVG91Y2hFbmQodGhpcy50b3VjaEVuZEhhbmRsZXIpO1xufVxuXG5mdW5jdGlvbiBkaXNhYmxlVG91Y2goKSB7XG4gIHRoaXMub2ZmTW91c2VEb3duKHRoaXMubW91c2VEb3duSGFuZGxlcik7XG4gIHRoaXMub2ZmTW91c2VNb3ZlKHRoaXMubW91c2VNb3ZlSGFuZGxlcik7XG5cbiAgd2luZG93Lm9mZk1vdXNlVXAodGhpcy5tb3VzZVVwSGFuZGxlciwgdGhpcyk7XG5cbiAgdGhpcy5vZmZUb3VjaFN0YXJ0KHRoaXMudG91Y2hTdGFydEhhbmRsZXIpO1xuICB0aGlzLm9mZlRvdWNoTW92ZSh0aGlzLnRvdWNoTW92ZUhhbmRsZXIpO1xuICB0aGlzLm9mZlRvdWNoRW5kKHRoaXMudG91Y2hFbmRIYW5kbGVyKTtcbn1cblxuZnVuY3Rpb24gb25DdXN0b21UYXAodGFwQ3VzdG9tSGFuZGxlciwgZWxlbWVudCkge1xuICBjb25zdCBjdXN0b21FdmVudFR5cGUgPSBUQVBfQ1VTVE9NX0VWRU5UX1RZUEUsXG4gICAgICAgIGN1c3RvbUhhbmRsZXIgPSB0YXBDdXN0b21IYW5kbGVyOyAvLy9cblxuICB0aGlzLm9uQ3VzdG9tRXZlbnQoY3VzdG9tRXZlbnRUeXBlLCBjdXN0b21IYW5kbGVyLCBlbGVtZW50KTtcbn1cblxuZnVuY3Rpb24gb2ZmQ3VzdG9tVGFwKHRhcEN1c3RvbUhhbmRsZXIsIGVsZW1lbnQpIHtcbiAgY29uc3QgY3VzdG9tRXZlbnRUeXBlID0gVEFQX0NVU1RPTV9FVkVOVF9UWVBFLFxuICAgICAgICBjdXN0b21IYW5kbGVyID0gdGFwQ3VzdG9tSGFuZGxlcjsgLy8vXG5cbiAgdGhpcy5vZmZDdXN0b21FdmVudChjdXN0b21FdmVudFR5cGUsIGN1c3RvbUhhbmRsZXIsIGVsZW1lbnQpO1xufVxuXG5mdW5jdGlvbiBvbkN1c3RvbVN3aXBlTGVmdChzd2lwZUxlZnRDdXN0b21IYW5kbGVyLCBlbGVtZW50KSB7XG4gIGNvbnN0IGN1c3RvbUV2ZW50VHlwZSA9IFNXSVBFX0xFRlRfQ1VTVE9NX0VWRU5UX1RZUEUsXG4gICAgICAgIGN1c3RvbUhhbmRsZXIgPSBzd2lwZUxlZnRDdXN0b21IYW5kbGVyOyAvLy9cblxuICB0aGlzLm9uQ3VzdG9tRXZlbnQoY3VzdG9tRXZlbnRUeXBlLCBjdXN0b21IYW5kbGVyLCBlbGVtZW50KTtcbn1cblxuZnVuY3Rpb24gb2ZmQ3VzdG9tU3dpcGVMZWZ0KHN3aXBlTGVmdEN1c3RvbUhhbmRsZXIsIGVsZW1lbnQpIHtcbiAgY29uc3QgY3VzdG9tRXZlbnRUeXBlID0gU1dJUEVfTEVGVF9DVVNUT01fRVZFTlRfVFlQRSxcbiAgICAgICAgY3VzdG9tSGFuZGxlciA9IHN3aXBlTGVmdEN1c3RvbUhhbmRsZXI7IC8vL1xuXG4gIHRoaXMub2ZmQ3VzdG9tRXZlbnQoY3VzdG9tRXZlbnRUeXBlLCBjdXN0b21IYW5kbGVyLCBlbGVtZW50KTtcbn1cblxuZnVuY3Rpb24gb25DdXN0b21Td2lwZVJpZ2h0KHN3aXBlUmlnaHRDdXN0b21IYW5kbGVyLCBlbGVtZW50KSB7XG4gIGNvbnN0IGN1c3RvbUV2ZW50VHlwZSA9IFNXSVBFX1JJR0hUX0NVU1RPTV9FVkVOVF9UWVBFLFxuICAgICAgICBjdXN0b21IYW5kbGVyID0gc3dpcGVSaWdodEN1c3RvbUhhbmRsZXI7IC8vL1xuXG4gIHRoaXMub25DdXN0b21FdmVudChjdXN0b21FdmVudFR5cGUsIGN1c3RvbUhhbmRsZXIsIGVsZW1lbnQpO1xufVxuXG5mdW5jdGlvbiBvZmZDdXN0b21Td2lwZVJpZ2h0KHN3aXBlUmlnaHRDdXN0b21IYW5kbGVyLCBlbGVtZW50KSB7XG4gIGNvbnN0IGN1c3RvbUV2ZW50VHlwZSA9IFNXSVBFX1JJR0hUX0NVU1RPTV9FVkVOVF9UWVBFLFxuICAgICAgICBjdXN0b21IYW5kbGVyID0gc3dpcGVSaWdodEN1c3RvbUhhbmRsZXI7IC8vL1xuXG4gIHRoaXMub2ZmQ3VzdG9tRXZlbnQoY3VzdG9tRXZlbnRUeXBlLCBjdXN0b21IYW5kbGVyLCBlbGVtZW50KTtcbn1cblxuZnVuY3Rpb24gZ2V0U3RhcnRQb3NpdGlvbigpIHtcbiAgY29uc3QgeyBzdGFydFBvc2l0aW9uIH0gPSB0aGlzLmdldFN0YXRlKCk7XG5cbiAgcmV0dXJuIHN0YXJ0UG9zaXRpb247XG59XG5cbmZ1bmN0aW9uIHNldFN0YXJ0UG9zaXRpb24oc3RhcnRQb3NpdGlvbikge1xuICB0aGlzLnVwZGF0ZVN0YXRlKHtcbiAgICBzdGFydFBvc2l0aW9uXG4gIH0pO1xufVxuXG5mdW5jdGlvbiB0b3VjaFN0YXJ0SGFuZGxlcihldmVudCwgZWxlbWVudCkge1xuICB0aGlzLnN0YXJ0SGFuZGxlcihldmVudCwgZWxlbWVudCwgKGV2ZW50KSA9PiB7XG4gICAgY29uc3QgdG91Y2hFdmVudCA9IGV2ZW50LCAvLy9cbiAgICAgICAgICBwb3NpdGlvbiA9IFBvc2l0aW9uLmZyb21Ub3VjaEV2ZW50KHRvdWNoRXZlbnQpO1xuXG4gICAgcmV0dXJuIHBvc2l0aW9uO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gbW91c2VEb3duSGFuZGxlcihldmVudCwgZWxlbWVudCkge1xuICB0aGlzLnN0YXJ0SGFuZGxlcihldmVudCwgZWxlbWVudCwgKGV2ZW50KSA9PiB7ICAvLy9cbiAgICBjb25zdCBtb3VzZUV2ZW50ID0gZXZlbnQsIC8vL1xuICAgICAgICAgIHBvc2l0aW9uID0gUG9zaXRpb24uZnJvbU1vdXNlRXZlbnQobW91c2VFdmVudCk7XG5cbiAgICByZXR1cm4gcG9zaXRpb247XG4gIH0pO1xufVxuXG5mdW5jdGlvbiB0b3VjaE1vdmVIYW5kbGVyKGV2ZW50LCBlbGVtZW50KSB7XG4gIHRoaXMubW92ZUhhbmRsZXIoZXZlbnQsIGVsZW1lbnQsIChldmVudCkgPT4ge1xuICAgIGNvbnN0IHRvdWNoRXZlbnQgPSBldmVudCwgLy8vXG4gICAgICAgICAgcG9zaXRpb24gPSBQb3NpdGlvbi5mcm9tVG91Y2hFdmVudCh0b3VjaEV2ZW50KTtcblxuICAgIHJldHVybiBwb3NpdGlvbjtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIG1vdXNlTW92ZUhhbmRsZXIoZXZlbnQsIGVsZW1lbnQpIHtcbiAgdGhpcy5tb3ZlSGFuZGxlcihldmVudCwgZWxlbWVudCwgKGV2ZW50KSA9PiB7XG4gICAgY29uc3QgbW91c2VFdmVudCA9IGV2ZW50LCAvLy9cbiAgICAgICAgICBwb3NpdGlvbiA9IFBvc2l0aW9uLmZyb21Nb3VzZUV2ZW50KG1vdXNlRXZlbnQpO1xuXG4gICAgcmV0dXJuIHBvc2l0aW9uO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gdG91Y2hFbmRIYW5kbGVyKGV2ZW50LCBlbGVtZW50KSB7XG4gIHRoaXMuZW5kSGFuZGxlcihldmVudCwgZWxlbWVudCwgKGV2ZW50KSA9PiB7XG4gICAgY29uc3QgdG91Y2hFdmVudCA9IGV2ZW50LCAvLy9cbiAgICAgICAgICBwb3NpdGlvbiA9IFBvc2l0aW9uLmZyb21Ub3VjaEV2ZW50KHRvdWNoRXZlbnQpO1xuXG4gICAgcmV0dXJuIHBvc2l0aW9uO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gbW91c2VVcEhhbmRsZXIoZXZlbnQsIGVsZW1lbnQpIHtcbiAgdGhpcy5lbmRIYW5kbGVyKGV2ZW50LCBlbGVtZW50LCAoZXZlbnQpID0+IHsgIC8vL1xuICAgIGNvbnN0IG1vdXNlRXZlbnQgPSBldmVudCwgLy8vXG4gICAgICAgICAgcG9zaXRpb24gPSBQb3NpdGlvbi5mcm9tTW91c2VFdmVudChtb3VzZUV2ZW50KTtcblxuICAgIHJldHVybiBwb3NpdGlvbjtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHN0YXJ0SGFuZGxlcihldmVudCwgZWxlbWVudCwgcG9zaXRpb25Gcm9tRXZlbnQpIHtcbiAgY29uc3QgcG9zaXRpb24gPSBwb3NpdGlvbkZyb21FdmVudChldmVudCksXG4gICAgICAgIHN0YXJ0UG9zaXRpb24gPSBwb3NpdGlvbjsgIC8vL1xuXG4gIHRoaXMuc2V0U3RhcnRQb3NpdGlvbihzdGFydFBvc2l0aW9uKTtcbn1cblxuZnVuY3Rpb24gbW92ZUhhbmRsZXIoZXZlbnQsIGVsZW1lbnQsIHBvc2l0aW9uRnJvbUV2ZW50KSB7XG4gIGxldCBzdGFydFBvc2l0aW9uID0gdGhpcy5nZXRTdGFydFBvc2l0aW9uKCk7XG5cbiAgaWYgKHN0YXJ0UG9zaXRpb24gIT09IG51bGwpIHtcbiAgICBjb25zdCBwb3NpdGlvbiA9IHBvc2l0aW9uRnJvbUV2ZW50KGV2ZW50KTtcblxuICAgIGlmIChwb3NpdGlvbiAhPT0gbnVsbCkge1xuICAgICAgY29uc3QgcG9zaXRpb25NYXRjaGVzU3RhcnRQb3NpdGlvbiA9IHBvc2l0aW9uLm1hdGNoKHN0YXJ0UG9zaXRpb24pO1xuXG4gICAgICBpZiAocG9zaXRpb25NYXRjaGVzU3RhcnRQb3NpdGlvbikge1xuICAgICAgICBjb25zdCB2ZWxvY2l0eSA9IFZlbG9jaXR5LmZyb21Qb3NpdGlvbkFuZFN0YXJ0UG9zaXRpb24ocG9zaXRpb24sIHN0YXJ0UG9zaXRpb24pLFxuICAgICAgICAgICAgICBzcGVlZCA9IHZlbG9jaXR5LmdldFNwZWVkKCk7XG5cbiAgICAgICAgaWYgKHNwZWVkID4gTUlOSU1VTV9TV0lQRV9TUEVFRCkge1xuICAgICAgICAgIGNvbnN0IGFic29sdXRlRGlyZWN0aW9uID0gdmVsb2NpdHkuZ2V0QWJzb2x1dGVEaXJlY3Rpb24oKTtcblxuICAgICAgICAgIGlmIChhYnNvbHV0ZURpcmVjdGlvbiA8IE1BWElNVU1fU1dJUEVfQUJTT0xVVEVfRElSRUNUSU9OKSB7XG4gICAgICAgICAgICBjb25zdCBjdXN0b21FdmVudFR5cGUgPSBTV0lQRV9SSUdIVF9DVVNUT01fRVZFTlRfVFlQRTtcblxuICAgICAgICAgICAgdGhpcy5jYWxsQ3VzdG9tSGFuZGxlcnMoY3VzdG9tRXZlbnRUeXBlLCBldmVudCwgZWxlbWVudCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKChPTkVfSFVORFJFRF9BTkRfRUlHSFRZIC0gYWJzb2x1dGVEaXJlY3Rpb24pIDwgTUFYSU1VTV9TV0lQRV9BQlNPTFVURV9ESVJFQ1RJT04pIHtcbiAgICAgICAgICAgIGNvbnN0IGN1c3RvbUV2ZW50VHlwZSA9IFNXSVBFX0xFRlRfQ1VTVE9NX0VWRU5UX1RZUEU7XG5cbiAgICAgICAgICAgIHRoaXMuY2FsbEN1c3RvbUhhbmRsZXJzKGN1c3RvbUV2ZW50VHlwZSwgZXZlbnQsIGVsZW1lbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBlbmRIYW5kbGVyKGV2ZW50LCBlbGVtZW50LCBwb3NpdGlvbkZyb21FdmVudCkge1xuICBsZXQgc3RhcnRQb3NpdGlvbjtcblxuICBzdGFydFBvc2l0aW9uID0gdGhpcy5nZXRTdGFydFBvc2l0aW9uKCk7XG5cbiAgaWYgKHN0YXJ0UG9zaXRpb24gIT09IG51bGwpIHtcbiAgICBjb25zdCBwb3NpdGlvbiA9IHBvc2l0aW9uRnJvbUV2ZW50KGV2ZW50KTtcblxuICAgIGlmIChwb3NpdGlvbiAhPT0gbnVsbCkge1xuICAgICAgY29uc3QgcG9zaXRpb25NYXRjaGVzU3RhcnRQb3NpdGlvbiA9IHBvc2l0aW9uLm1hdGNoKHN0YXJ0UG9zaXRpb24pO1xuXG4gICAgICBpZiAocG9zaXRpb25NYXRjaGVzU3RhcnRQb3NpdGlvbikge1xuICAgICAgICBjb25zdCB2ZWxvY2l0eSA9IFZlbG9jaXR5LmZyb21Qb3NpdGlvbkFuZFN0YXJ0UG9zaXRpb24ocG9zaXRpb24sIHN0YXJ0UG9zaXRpb24pLFxuICAgICAgICAgICAgICBzcGVlZCA9IHZlbG9jaXR5LmdldFNwZWVkKCk7XG5cbiAgICAgICAgaWYgKHNwZWVkID09PSAwKSB7XG4gICAgICAgICAgY29uc3QgdGltZSA9IHZlbG9jaXR5LmdldFRpbWUoKTtcblxuICAgICAgICAgIGlmICh0aW1lIDwgTUFYSU1VTV9UQVBfVElNRSkge1xuICAgICAgICAgICAgY29uc3QgY3VzdG9tRXZlbnRUeXBlID0gVEFQX0NVU1RPTV9FVkVOVF9UWVBFO1xuXG4gICAgICAgICAgICB0aGlzLmNhbGxDdXN0b21IYW5kbGVycyhjdXN0b21FdmVudFR5cGUsIGV2ZW50LCBlbGVtZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuY29uc3QgY3VzdG9tRXZlbnRNaXhpbnMgPSB7XG4gIGVuYWJsZVRvdWNoLFxuICBkaXNhYmxlVG91Y2gsXG4gIG9uQ3VzdG9tVGFwLFxuICBvZmZDdXN0b21UYXAsXG4gIG9uQ3VzdG9tU3dpcGVMZWZ0LFxuICBvZmZDdXN0b21Td2lwZUxlZnQsXG4gIG9uQ3VzdG9tU3dpcGVSaWdodCxcbiAgb2ZmQ3VzdG9tU3dpcGVSaWdodCxcbiAgZ2V0U3RhcnRQb3NpdGlvbixcbiAgc2V0U3RhcnRQb3NpdGlvbixcbiAgdG91Y2hTdGFydEhhbmRsZXIsXG4gIG1vdXNlRG93bkhhbmRsZXIsXG4gIHRvdWNoTW92ZUhhbmRsZXIsXG4gIG1vdXNlTW92ZUhhbmRsZXIsXG4gIHRvdWNoRW5kSGFuZGxlcixcbiAgbW91c2VVcEhhbmRsZXIsXG4gIHN0YXJ0SGFuZGxlcixcbiAgbW92ZUhhbmRsZXIsXG4gIGVuZEhhbmRsZXJcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGN1c3RvbUV2ZW50TWl4aW5zO1xuIl0sIm5hbWVzIjpbImVuYWJsZVRvdWNoIiwic3RhcnRQb3NpdGlvbiIsInVwZGF0ZVN0YXRlIiwib25Nb3VzZURvd24iLCJtb3VzZURvd25IYW5kbGVyIiwib25Nb3VzZU1vdmUiLCJtb3VzZU1vdmVIYW5kbGVyIiwid2luZG93Iiwib25Nb3VzZVVwIiwibW91c2VVcEhhbmRsZXIiLCJvblRvdWNoU3RhcnQiLCJ0b3VjaFN0YXJ0SGFuZGxlciIsIm9uVG91Y2hNb3ZlIiwidG91Y2hNb3ZlSGFuZGxlciIsIm9uVG91Y2hFbmQiLCJ0b3VjaEVuZEhhbmRsZXIiLCJkaXNhYmxlVG91Y2giLCJvZmZNb3VzZURvd24iLCJvZmZNb3VzZU1vdmUiLCJvZmZNb3VzZVVwIiwib2ZmVG91Y2hTdGFydCIsIm9mZlRvdWNoTW92ZSIsIm9mZlRvdWNoRW5kIiwib25DdXN0b21UYXAiLCJ0YXBDdXN0b21IYW5kbGVyIiwiZWxlbWVudCIsImN1c3RvbUV2ZW50VHlwZSIsIlRBUF9DVVNUT01fRVZFTlRfVFlQRSIsImN1c3RvbUhhbmRsZXIiLCJvbkN1c3RvbUV2ZW50Iiwib2ZmQ3VzdG9tVGFwIiwib2ZmQ3VzdG9tRXZlbnQiLCJvbkN1c3RvbVN3aXBlTGVmdCIsInN3aXBlTGVmdEN1c3RvbUhhbmRsZXIiLCJTV0lQRV9MRUZUX0NVU1RPTV9FVkVOVF9UWVBFIiwib2ZmQ3VzdG9tU3dpcGVMZWZ0Iiwib25DdXN0b21Td2lwZVJpZ2h0Iiwic3dpcGVSaWdodEN1c3RvbUhhbmRsZXIiLCJTV0lQRV9SSUdIVF9DVVNUT01fRVZFTlRfVFlQRSIsIm9mZkN1c3RvbVN3aXBlUmlnaHQiLCJnZXRTdGFydFBvc2l0aW9uIiwiZ2V0U3RhdGUiLCJzZXRTdGFydFBvc2l0aW9uIiwiZXZlbnQiLCJzdGFydEhhbmRsZXIiLCJ0b3VjaEV2ZW50IiwicG9zaXRpb24iLCJQb3NpdGlvbiIsImZyb21Ub3VjaEV2ZW50IiwibW91c2VFdmVudCIsImZyb21Nb3VzZUV2ZW50IiwibW92ZUhhbmRsZXIiLCJlbmRIYW5kbGVyIiwicG9zaXRpb25Gcm9tRXZlbnQiLCJwb3NpdGlvbk1hdGNoZXNTdGFydFBvc2l0aW9uIiwibWF0Y2giLCJ2ZWxvY2l0eSIsIlZlbG9jaXR5IiwiZnJvbVBvc2l0aW9uQW5kU3RhcnRQb3NpdGlvbiIsInNwZWVkIiwiZ2V0U3BlZWQiLCJNSU5JTVVNX1NXSVBFX1NQRUVEIiwiYWJzb2x1dGVEaXJlY3Rpb24iLCJnZXRBYnNvbHV0ZURpcmVjdGlvbiIsIk1BWElNVU1fU1dJUEVfQUJTT0xVVEVfRElSRUNUSU9OIiwiY2FsbEN1c3RvbUhhbmRsZXJzIiwiT05FX0hVTkRSRURfQU5EX0VJR0hUWSIsInRpbWUiLCJnZXRUaW1lIiwiTUFYSU1VTV9UQVBfVElNRSIsImN1c3RvbUV2ZW50TWl4aW5zIl0sInJhbmdlTWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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