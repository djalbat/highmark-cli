"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return createHighmarkCSSOperation;
    }
});
var _highmarkclient = require("highmark-client");
var _highmarkmarkdown = require("highmark-markdown");
var _constants = require("../constants");
var _division = require("../utilities/division");
var _fileSystem = require("../utilities/fileSystem");
var _filePath = require("../utilities/filePath");
var getClientCSSSelectorsString = _highmarkclient.clientUtilities.getClientCSSSelectorsString, cssFromMarkdownStyleAndCSSSelectorsString = _highmarkmarkdown.grammarUtilities.cssFromMarkdownStyleAndCSSSelectorsString;
function createHighmarkCSSOperation(proceed, abort, context) {
    var client = context.client, projectDirectoryName = context.projectDirectoryName, projectDirectoryPath = projectDirectoryName, markdownStyleFilePaths = [];
    (0, _fileSystem.readDirectory)(projectDirectoryPath, function(filePath) {
        var filePathMarkdownStyleFilePath = (0, _filePath.isFilePathMarkdownStyleFilePath)(filePath);
        if (filePathMarkdownStyleFilePath) {
            var markdownStyleFilePath = filePath, filePathDefaultMarkdownStyleFilePath = (0, _filePath.isFilePathDefaultMarkdownStyleFilePath)(filePath);
            filePathDefaultMarkdownStyleFilePath ? markdownStyleFilePaths.unshift(markdownStyleFilePath) : markdownStyleFilePaths.push(markdownStyleFilePath);
        }
    });
    var cssSelectorString = getCSSSelectorsString(client), markdownStyle = _highmarkmarkdown.defaultMarkdownStyle, css = cssFromMarkdownStyleAndCSSSelectorsString(markdownStyle, cssSelectorString);
    var highmarkCSS = css; ///
    markdownStyleFilePaths.forEach(function(markdownStyleFilePath) {
        var cssSelectorString = cssSelectorStringFromMarkdownStyleFilePathAndClient(markdownStyleFilePath, client), markdownStyle = markdownStyleFromMarkdownStyleFilePath(markdownStyleFilePath), css = cssFromMarkdownStyleAndCSSSelectorsString(markdownStyle, cssSelectorString); ///
        highmarkCSS = "".concat(highmarkCSS).concat(css);
    });
    Object.assign(context, {
        highmarkCSS: highmarkCSS
    });
    proceed();
}
function getCSSSelectorsString(client) {
    var cssSelectorString = client ? getClientCSSSelectorsString() : _constants.CSS_SELECTORS_STRING;
    return cssSelectorString;
}
function markdownStyleFromMarkdownStyleFilePath(markdownStyleFilePath) {
    var filePath = markdownStyleFilePath, content = (0, _fileSystem.readFile)(filePath), markdownStyle = content; ///
    return markdownStyle;
}
function cssSelectorStringFromMarkdownStyleFilePathAndClient(markdownStyleFilePath, client) {
    var cssSelectorString = getCSSSelectorsString(client);
    var filePath = markdownStyleFilePath, className = (0, _division.classNameFromFilePath)(filePath);
    if (className !== null) {
        cssSelectorString = "".concat(cssSelectorString, ".").concat(className);
    }
    return cssSelectorString;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9vcGVyYXRpb24vY3JlYXRlSGlnaG1hcmtDU1MuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB7IGNsaWVudFV0aWxpdGllcyB9IGZyb20gXCJoaWdobWFyay1jbGllbnRcIjtcbmltcG9ydCB7IGdyYW1tYXJVdGlsaXRpZXMsIGRlZmF1bHRNYXJrZG93blN0eWxlIH0gZnJvbSBcImhpZ2htYXJrLW1hcmtkb3duXCI7XG5cbmltcG9ydCB7IENTU19TRUxFQ1RPUlNfU1RSSU5HIH0gZnJvbSBcIi4uL2NvbnN0YW50c1wiO1xuaW1wb3J0IHsgY2xhc3NOYW1lRnJvbUZpbGVQYXRoIH0gZnJvbSBcIi4uL3V0aWxpdGllcy9kaXZpc2lvblwiO1xuaW1wb3J0IHsgcmVhZEZpbGUsIHJlYWREaXJlY3RvcnkgfSBmcm9tIFwiLi4vdXRpbGl0aWVzL2ZpbGVTeXN0ZW1cIjtcbmltcG9ydCB7IGlzRmlsZVBhdGhNYXJrZG93blN0eWxlRmlsZVBhdGgsIGlzRmlsZVBhdGhEZWZhdWx0TWFya2Rvd25TdHlsZUZpbGVQYXRoIH0gZnJvbSBcIi4uL3V0aWxpdGllcy9maWxlUGF0aFwiO1xuXG5jb25zdCB7IGdldENsaWVudENTU1NlbGVjdG9yc1N0cmluZyB9ID0gY2xpZW50VXRpbGl0aWVzLFxuICAgICAgeyBjc3NGcm9tTWFya2Rvd25TdHlsZUFuZENTU1NlbGVjdG9yc1N0cmluZyB9ID0gZ3JhbW1hclV0aWxpdGllcztcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gY3JlYXRlSGlnaG1hcmtDU1NPcGVyYXRpb24ocHJvY2VlZCwgYWJvcnQsIGNvbnRleHQpIHtcbiAgY29uc3QgeyBjbGllbnQsIHByb2plY3REaXJlY3RvcnlOYW1lIH0gPSBjb250ZXh0LFxuICAgICAgICBwcm9qZWN0RGlyZWN0b3J5UGF0aCA9IHByb2plY3REaXJlY3RvcnlOYW1lLCAgLy8vXG4gICAgICAgIG1hcmtkb3duU3R5bGVGaWxlUGF0aHMgPSBbXTtcblxuICByZWFkRGlyZWN0b3J5KHByb2plY3REaXJlY3RvcnlQYXRoLCAoZmlsZVBhdGgpID0+IHtcbiAgICBjb25zdCBmaWxlUGF0aE1hcmtkb3duU3R5bGVGaWxlUGF0aCA9IGlzRmlsZVBhdGhNYXJrZG93blN0eWxlRmlsZVBhdGgoZmlsZVBhdGgpO1xuXG4gICAgaWYgKGZpbGVQYXRoTWFya2Rvd25TdHlsZUZpbGVQYXRoKSB7XG4gICAgICBjb25zdCBtYXJrZG93blN0eWxlRmlsZVBhdGggPSBmaWxlUGF0aCxcbiAgICAgICAgICAgIGZpbGVQYXRoRGVmYXVsdE1hcmtkb3duU3R5bGVGaWxlUGF0aCA9IGlzRmlsZVBhdGhEZWZhdWx0TWFya2Rvd25TdHlsZUZpbGVQYXRoKGZpbGVQYXRoKTtcblxuICAgICAgZmlsZVBhdGhEZWZhdWx0TWFya2Rvd25TdHlsZUZpbGVQYXRoID9cbiAgICAgICAgbWFya2Rvd25TdHlsZUZpbGVQYXRocy51bnNoaWZ0KG1hcmtkb3duU3R5bGVGaWxlUGF0aCkgOlxuICAgICAgICAgIG1hcmtkb3duU3R5bGVGaWxlUGF0aHMucHVzaChtYXJrZG93blN0eWxlRmlsZVBhdGgpO1xuICAgIH1cbiAgfSk7XG5cbiAgY29uc3QgY3NzU2VsZWN0b3JTdHJpbmcgPSBnZXRDU1NTZWxlY3RvcnNTdHJpbmcoY2xpZW50KSxcbiAgICAgICAgbWFya2Rvd25TdHlsZSA9IGRlZmF1bHRNYXJrZG93blN0eWxlLCAvLy9cbiAgICAgICAgY3NzID0gY3NzRnJvbU1hcmtkb3duU3R5bGVBbmRDU1NTZWxlY3RvcnNTdHJpbmcobWFya2Rvd25TdHlsZSwgY3NzU2VsZWN0b3JTdHJpbmcpO1xuXG4gIGxldCBoaWdobWFya0NTUyA9IGNzczsgLy8vXG5cbiAgbWFya2Rvd25TdHlsZUZpbGVQYXRocy5mb3JFYWNoKChtYXJrZG93blN0eWxlRmlsZVBhdGgpID0+IHtcbiAgICBjb25zdCBjc3NTZWxlY3RvclN0cmluZyA9IGNzc1NlbGVjdG9yU3RyaW5nRnJvbU1hcmtkb3duU3R5bGVGaWxlUGF0aEFuZENsaWVudChtYXJrZG93blN0eWxlRmlsZVBhdGgsIGNsaWVudCksXG4gICAgICAgICAgbWFya2Rvd25TdHlsZSA9IG1hcmtkb3duU3R5bGVGcm9tTWFya2Rvd25TdHlsZUZpbGVQYXRoKG1hcmtkb3duU3R5bGVGaWxlUGF0aCksXG4gICAgICAgICAgY3NzID0gY3NzRnJvbU1hcmtkb3duU3R5bGVBbmRDU1NTZWxlY3RvcnNTdHJpbmcobWFya2Rvd25TdHlsZSwgY3NzU2VsZWN0b3JTdHJpbmcpOyAgLy8vXG5cbiAgICBoaWdobWFya0NTUyA9IGAke2hpZ2htYXJrQ1NTfSR7Y3NzfWA7XG4gIH0pO1xuXG4gIE9iamVjdC5hc3NpZ24oY29udGV4dCwge1xuICAgIGhpZ2htYXJrQ1NTXG4gIH0pO1xuXG4gIHByb2NlZWQoKTtcbn1cblxuZnVuY3Rpb24gZ2V0Q1NTU2VsZWN0b3JzU3RyaW5nKGNsaWVudCkge1xuICBjb25zdCBjc3NTZWxlY3RvclN0cmluZyA9IGNsaWVudCA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRDbGllbnRDU1NTZWxlY3RvcnNTdHJpbmcoKSA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENTU19TRUxFQ1RPUlNfU1RSSU5HO1xuXG4gIHJldHVybiBjc3NTZWxlY3RvclN0cmluZztcbn1cblxuZnVuY3Rpb24gbWFya2Rvd25TdHlsZUZyb21NYXJrZG93blN0eWxlRmlsZVBhdGgobWFya2Rvd25TdHlsZUZpbGVQYXRoKSB7XG4gIGNvbnN0IGZpbGVQYXRoID0gbWFya2Rvd25TdHlsZUZpbGVQYXRoLCAvLy9cbiAgICAgICAgY29udGVudCA9IHJlYWRGaWxlKGZpbGVQYXRoKSxcbiAgICAgICAgbWFya2Rvd25TdHlsZSA9IGNvbnRlbnQ7ICAvLy9cblxuICByZXR1cm4gbWFya2Rvd25TdHlsZTtcbn1cblxuZnVuY3Rpb24gY3NzU2VsZWN0b3JTdHJpbmdGcm9tTWFya2Rvd25TdHlsZUZpbGVQYXRoQW5kQ2xpZW50KG1hcmtkb3duU3R5bGVGaWxlUGF0aCwgY2xpZW50KSB7XG4gIGxldCBjc3NTZWxlY3RvclN0cmluZyA9IGdldENTU1NlbGVjdG9yc1N0cmluZyhjbGllbnQpO1xuXG4gIGNvbnN0IGZpbGVQYXRoID0gbWFya2Rvd25TdHlsZUZpbGVQYXRoLCAgLy8vXG4gICAgICAgIGNsYXNzTmFtZSA9IGNsYXNzTmFtZUZyb21GaWxlUGF0aChmaWxlUGF0aCk7XG5cbiAgaWYgKGNsYXNzTmFtZSAhPT0gbnVsbCkge1xuICAgIGNzc1NlbGVjdG9yU3RyaW5nID0gYCR7Y3NzU2VsZWN0b3JTdHJpbmd9LiR7Y2xhc3NOYW1lfWA7XG4gIH1cblxuICByZXR1cm4gY3NzU2VsZWN0b3JTdHJpbmc7XG59XG4iXSwibmFtZXMiOlsiY3JlYXRlSGlnaG1hcmtDU1NPcGVyYXRpb24iLCJnZXRDbGllbnRDU1NTZWxlY3RvcnNTdHJpbmciLCJjbGllbnRVdGlsaXRpZXMiLCJjc3NGcm9tTWFya2Rvd25TdHlsZUFuZENTU1NlbGVjdG9yc1N0cmluZyIsImdyYW1tYXJVdGlsaXRpZXMiLCJwcm9jZWVkIiwiYWJvcnQiLCJjb250ZXh0IiwiY2xpZW50IiwicHJvamVjdERpcmVjdG9yeU5hbWUiLCJwcm9qZWN0RGlyZWN0b3J5UGF0aCIsIm1hcmtkb3duU3R5bGVGaWxlUGF0aHMiLCJyZWFkRGlyZWN0b3J5IiwiZmlsZVBhdGgiLCJmaWxlUGF0aE1hcmtkb3duU3R5bGVGaWxlUGF0aCIsImlzRmlsZVBhdGhNYXJrZG93blN0eWxlRmlsZVBhdGgiLCJtYXJrZG93blN0eWxlRmlsZVBhdGgiLCJmaWxlUGF0aERlZmF1bHRNYXJrZG93blN0eWxlRmlsZVBhdGgiLCJpc0ZpbGVQYXRoRGVmYXVsdE1hcmtkb3duU3R5bGVGaWxlUGF0aCIsInVuc2hpZnQiLCJwdXNoIiwiY3NzU2VsZWN0b3JTdHJpbmciLCJnZXRDU1NTZWxlY3RvcnNTdHJpbmciLCJtYXJrZG93blN0eWxlIiwiZGVmYXVsdE1hcmtkb3duU3R5bGUiLCJjc3MiLCJoaWdobWFya0NTUyIsImZvckVhY2giLCJjc3NTZWxlY3RvclN0cmluZ0Zyb21NYXJrZG93blN0eWxlRmlsZVBhdGhBbmRDbGllbnQiLCJtYXJrZG93blN0eWxlRnJvbU1hcmtkb3duU3R5bGVGaWxlUGF0aCIsIk9iamVjdCIsImFzc2lnbiIsIkNTU19TRUxFQ1RPUlNfU1RSSU5HIiwiY29udGVudCIsInJlYWRGaWxlIiwiY2xhc3NOYW1lIiwiY2xhc3NOYW1lRnJvbUZpbGVQYXRoIl0sIm1hcHBpbmdzIjoiQUFBQTs7OzsrQkFhQTs7O2VBQXdCQTs7OzhCQVhRO2dDQUN1Qjt5QkFFbEI7d0JBQ0M7MEJBQ0U7d0JBQ2dEO0FBRXhGLElBQU0sQUFBRUMsOEJBQWdDQywrQkFBZSxDQUEvQ0QsNkJBQ0YsQUFBRUUsNENBQThDQyxrQ0FBZ0IsQ0FBOUREO0FBRU8sU0FBU0gsMkJBQTJCSyxPQUFPLEVBQUVDLEtBQUssRUFBRUMsT0FBTztJQUN4RSxJQUFRQyxTQUFpQ0QsUUFBakNDLFFBQVFDLHVCQUF5QkYsUUFBekJFLHNCQUNWQyx1QkFBdUJELHNCQUN2QkUseUJBQXlCLEVBQUU7SUFFakNDLElBQUFBLHlCQUFhLEVBQUNGLHNCQUFzQixTQUFDRztRQUNuQyxJQUFNQyxnQ0FBZ0NDLElBQUFBLHlDQUErQixFQUFDRjtRQUV0RSxJQUFJQywrQkFBK0I7WUFDakMsSUFBTUUsd0JBQXdCSCxVQUN4QkksdUNBQXVDQyxJQUFBQSxnREFBc0MsRUFBQ0w7WUFFcEZJLHVDQUNFTix1QkFBdUJRLE9BQU8sQ0FBQ0gseUJBQzdCTCx1QkFBdUJTLElBQUksQ0FBQ0o7UUFDbEM7SUFDRjtJQUVBLElBQU1LLG9CQUFvQkMsc0JBQXNCZCxTQUMxQ2UsZ0JBQWdCQyxzQ0FBb0IsRUFDcENDLE1BQU10QiwwQ0FBMENvQixlQUFlRjtJQUVyRSxJQUFJSyxjQUFjRCxLQUFLLEdBQUc7SUFFMUJkLHVCQUF1QmdCLE9BQU8sQ0FBQyxTQUFDWDtRQUM5QixJQUFNSyxvQkFBb0JPLG9EQUFvRFosdUJBQXVCUixTQUMvRmUsZ0JBQWdCTSx1Q0FBdUNiLHdCQUN2RFMsTUFBTXRCLDBDQUEwQ29CLGVBQWVGLG9CQUFxQixHQUFHO1FBRTdGSyxjQUFjLEFBQUMsR0FBZ0JELE9BQWRDLGFBQWtCLE9BQUpEO0lBQ2pDO0lBRUFLLE9BQU9DLE1BQU0sQ0FBQ3hCLFNBQVM7UUFDckJtQixhQUFBQTtJQUNGO0lBRUFyQjtBQUNGO0FBRUEsU0FBU2lCLHNCQUFzQmQsTUFBTTtJQUNuQyxJQUFNYSxvQkFBb0JiLFNBQ0VQLGdDQUNFK0IsK0JBQW9CO0lBRWxELE9BQU9YO0FBQ1Q7QUFFQSxTQUFTUSx1Q0FBdUNiLHFCQUFxQjtJQUNuRSxJQUFNSCxXQUFXRyx1QkFDWGlCLFVBQVVDLElBQUFBLG9CQUFRLEVBQUNyQixXQUNuQlUsZ0JBQWdCVSxTQUFVLEdBQUc7SUFFbkMsT0FBT1Y7QUFDVDtBQUVBLFNBQVNLLG9EQUFvRFoscUJBQXFCLEVBQUVSLE1BQU07SUFDeEYsSUFBSWEsb0JBQW9CQyxzQkFBc0JkO0lBRTlDLElBQU1LLFdBQVdHLHVCQUNYbUIsWUFBWUMsSUFBQUEsK0JBQXFCLEVBQUN2QjtJQUV4QyxJQUFJc0IsY0FBYyxNQUFNO1FBQ3RCZCxvQkFBb0IsQUFBQyxHQUF1QmMsT0FBckJkLG1CQUFrQixLQUFhLE9BQVZjO0lBQzlDO0lBRUEsT0FBT2Q7QUFDVCJ9