"use strict";
import { constants } from "highmark-client";
import { cssUtilities, defaultMarkdownStyle } from "highmark-markdown";
import { DIVS_SELECTOR_STRING } from "../constants";
import { classNameFromFilePath } from "../utilities/division";
import { readFile, readDirectory } from "../utilities/fileSystem";
import { isFilePathMarkdownStyleFilePath, isFilePathDefaultMarkdownStyleFilePath } from "../utilities/filePath";
var CLIENT_DIVS_SELECTOR_STRING = constants.DIVS_SELECTOR_STRING, cssFromMarkdownStyleAndSelectorString = cssUtilities.cssFromMarkdownStyleAndSelectorString;
export default function markdownStylesCSSOperation(proceed, abort, context) {
    var client = context.client, projectDirectoryName = context.projectDirectoryName, projectDirectoryPath = projectDirectoryName, markdownStyleFilePaths = [];
    readDirectory(projectDirectoryPath, function(filePath) {
        var filePathMarkdownStyleFilePath = isFilePathMarkdownStyleFilePath(filePath);
        if (filePathMarkdownStyleFilePath) {
            var markdownStyleFilePath = filePath, filePathDefaultMarkdownStyleFilePath = isFilePathDefaultMarkdownStyleFilePath(filePath);
            filePathDefaultMarkdownStyleFilePath ? markdownStyleFilePaths.unshift(markdownStyleFilePath) : markdownStyleFilePaths.push(markdownStyleFilePath);
        }
    });
    var selectorString = client ? CLIENT_DIVS_SELECTOR_STRING : DIVS_SELECTOR_STRING, markdownStyle = defaultMarkdownStyle, defaultCSS = cssFromMarkdownStyleAndSelectorString(markdownStyle, selectorString);
    var markdownStylesCSS = defaultCSS; ///
    markdownStyleFilePaths.forEach(function(markdownStyleFilePath) {
        var selectorString = selectorStringFromMarkdownStyleFilePathAndClient(markdownStyleFilePath, client), markdownStyle = markdownStyleFromMarkdownStyleFilePath(markdownStyleFilePath), css = cssFromMarkdownStyleAndSelectorString(markdownStyle, selectorString, markdownStylesCSS); ///
        markdownStylesCSS = "".concat(markdownStylesCSS).concat(css);
    });
    Object.assign(context, {
        markdownStylesCSS: markdownStylesCSS
    });
    proceed();
}
function markdownStyleFromMarkdownStyleFilePath(markdownStyleFilePath) {
    var filePath = markdownStyleFilePath, content = readFile(filePath), markdownStyle = content; ///
    return markdownStyle;
}
function selectorStringFromMarkdownStyleFilePathAndClient(markdownStyleFilePath, client) {
    var selectorString = client ? CLIENT_DIVS_SELECTOR_STRING : DIVS_SELECTOR_STRING;
    var filePath = markdownStyleFilePath, className = classNameFromFilePath(filePath);
    if (className !== null) {
        selectorString = "".concat(selectorString, ".").concat(className);
    }
    return selectorString;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9vcGVyYXRpb24vbWFya2Rvd25TdHlsZXNDU1MuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB7IGNvbnN0YW50cyB9IGZyb20gXCJoaWdobWFyay1jbGllbnRcIjtcbmltcG9ydCB7IGNzc1V0aWxpdGllcywgZGVmYXVsdE1hcmtkb3duU3R5bGUgfSBmcm9tIFwiaGlnaG1hcmstbWFya2Rvd25cIjtcblxuaW1wb3J0IHsgRElWU19TRUxFQ1RPUl9TVFJJTkcgfSBmcm9tIFwiLi4vY29uc3RhbnRzXCI7XG5pbXBvcnQgeyBjbGFzc05hbWVGcm9tRmlsZVBhdGggfSBmcm9tIFwiLi4vdXRpbGl0aWVzL2RpdmlzaW9uXCI7XG5pbXBvcnQgeyByZWFkRmlsZSwgcmVhZERpcmVjdG9yeSB9IGZyb20gXCIuLi91dGlsaXRpZXMvZmlsZVN5c3RlbVwiO1xuaW1wb3J0IHsgaXNGaWxlUGF0aE1hcmtkb3duU3R5bGVGaWxlUGF0aCwgaXNGaWxlUGF0aERlZmF1bHRNYXJrZG93blN0eWxlRmlsZVBhdGggfSBmcm9tIFwiLi4vdXRpbGl0aWVzL2ZpbGVQYXRoXCI7XG5cbmNvbnN0IHsgRElWU19TRUxFQ1RPUl9TVFJJTkc6IENMSUVOVF9ESVZTX1NFTEVDVE9SX1NUUklORyB9ID0gY29uc3RhbnRzLFxuICAgICAgeyBjc3NGcm9tTWFya2Rvd25TdHlsZUFuZFNlbGVjdG9yU3RyaW5nIH0gPSBjc3NVdGlsaXRpZXM7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIG1hcmtkb3duU3R5bGVzQ1NTT3BlcmF0aW9uKHByb2NlZWQsIGFib3J0LCBjb250ZXh0KSB7XG4gIGNvbnN0IHsgY2xpZW50LCBwcm9qZWN0RGlyZWN0b3J5TmFtZSB9ID0gY29udGV4dCxcbiAgICAgICAgcHJvamVjdERpcmVjdG9yeVBhdGggPSBwcm9qZWN0RGlyZWN0b3J5TmFtZSwgIC8vL1xuICAgICAgICBtYXJrZG93blN0eWxlRmlsZVBhdGhzID0gW107XG5cbiAgcmVhZERpcmVjdG9yeShwcm9qZWN0RGlyZWN0b3J5UGF0aCwgKGZpbGVQYXRoKSA9PiB7XG4gICAgY29uc3QgZmlsZVBhdGhNYXJrZG93blN0eWxlRmlsZVBhdGggPSBpc0ZpbGVQYXRoTWFya2Rvd25TdHlsZUZpbGVQYXRoKGZpbGVQYXRoKTtcblxuICAgIGlmIChmaWxlUGF0aE1hcmtkb3duU3R5bGVGaWxlUGF0aCkge1xuICAgICAgY29uc3QgbWFya2Rvd25TdHlsZUZpbGVQYXRoID0gZmlsZVBhdGgsXG4gICAgICAgICAgICBmaWxlUGF0aERlZmF1bHRNYXJrZG93blN0eWxlRmlsZVBhdGggPSBpc0ZpbGVQYXRoRGVmYXVsdE1hcmtkb3duU3R5bGVGaWxlUGF0aChmaWxlUGF0aCk7XG5cbiAgICAgIGZpbGVQYXRoRGVmYXVsdE1hcmtkb3duU3R5bGVGaWxlUGF0aCA/XG4gICAgICAgIG1hcmtkb3duU3R5bGVGaWxlUGF0aHMudW5zaGlmdChtYXJrZG93blN0eWxlRmlsZVBhdGgpIDpcbiAgICAgICAgICBtYXJrZG93blN0eWxlRmlsZVBhdGhzLnB1c2gobWFya2Rvd25TdHlsZUZpbGVQYXRoKTtcbiAgICB9XG4gIH0pO1xuXG4gIGNvbnN0IHNlbGVjdG9yU3RyaW5nID0gY2xpZW50ID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgIENMSUVOVF9ESVZTX1NFTEVDVE9SX1NUUklORyA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIERJVlNfU0VMRUNUT1JfU1RSSU5HLFxuICAgICAgICBtYXJrZG93blN0eWxlID0gZGVmYXVsdE1hcmtkb3duU3R5bGUsIC8vL1xuICAgICAgICBkZWZhdWx0Q1NTID0gY3NzRnJvbU1hcmtkb3duU3R5bGVBbmRTZWxlY3RvclN0cmluZyhtYXJrZG93blN0eWxlLCBzZWxlY3RvclN0cmluZyk7XG5cbiAgbGV0IG1hcmtkb3duU3R5bGVzQ1NTID0gZGVmYXVsdENTUzsgLy8vXG5cbiAgbWFya2Rvd25TdHlsZUZpbGVQYXRocy5mb3JFYWNoKChtYXJrZG93blN0eWxlRmlsZVBhdGgpID0+IHtcbiAgICBjb25zdCBzZWxlY3RvclN0cmluZyA9IHNlbGVjdG9yU3RyaW5nRnJvbU1hcmtkb3duU3R5bGVGaWxlUGF0aEFuZENsaWVudChtYXJrZG93blN0eWxlRmlsZVBhdGgsIGNsaWVudCksXG4gICAgICAgICAgbWFya2Rvd25TdHlsZSA9IG1hcmtkb3duU3R5bGVGcm9tTWFya2Rvd25TdHlsZUZpbGVQYXRoKG1hcmtkb3duU3R5bGVGaWxlUGF0aCksXG4gICAgICAgICAgY3NzID0gY3NzRnJvbU1hcmtkb3duU3R5bGVBbmRTZWxlY3RvclN0cmluZyhtYXJrZG93blN0eWxlLCBzZWxlY3RvclN0cmluZywgbWFya2Rvd25TdHlsZXNDU1MpOyAgLy8vXG5cbiAgICBtYXJrZG93blN0eWxlc0NTUyA9IGAke21hcmtkb3duU3R5bGVzQ1NTfSR7Y3NzfWA7XG4gIH0pO1xuXG4gIE9iamVjdC5hc3NpZ24oY29udGV4dCwge1xuICAgIG1hcmtkb3duU3R5bGVzQ1NTXG4gIH0pO1xuXG4gIHByb2NlZWQoKTtcbn1cblxuZnVuY3Rpb24gbWFya2Rvd25TdHlsZUZyb21NYXJrZG93blN0eWxlRmlsZVBhdGgobWFya2Rvd25TdHlsZUZpbGVQYXRoKSB7XG4gIGNvbnN0IGZpbGVQYXRoID0gbWFya2Rvd25TdHlsZUZpbGVQYXRoLCAvLy9cbiAgICAgICAgY29udGVudCA9IHJlYWRGaWxlKGZpbGVQYXRoKSxcbiAgICAgICAgbWFya2Rvd25TdHlsZSA9IGNvbnRlbnQ7ICAvLy9cblxuICByZXR1cm4gbWFya2Rvd25TdHlsZTtcbn1cblxuZnVuY3Rpb24gc2VsZWN0b3JTdHJpbmdGcm9tTWFya2Rvd25TdHlsZUZpbGVQYXRoQW5kQ2xpZW50KG1hcmtkb3duU3R5bGVGaWxlUGF0aCwgY2xpZW50KSB7XG4gIGxldCBzZWxlY3RvclN0cmluZyA9IGNsaWVudCA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgQ0xJRU5UX0RJVlNfU0VMRUNUT1JfU1RSSU5HIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIERJVlNfU0VMRUNUT1JfU1RSSU5HO1xuXG4gIGNvbnN0IGZpbGVQYXRoID0gbWFya2Rvd25TdHlsZUZpbGVQYXRoLCAgLy8vXG4gICAgICAgIGNsYXNzTmFtZSA9IGNsYXNzTmFtZUZyb21GaWxlUGF0aChmaWxlUGF0aCk7XG5cbiAgaWYgKGNsYXNzTmFtZSAhPT0gbnVsbCkge1xuICAgIHNlbGVjdG9yU3RyaW5nID0gYCR7c2VsZWN0b3JTdHJpbmd9LiR7Y2xhc3NOYW1lfWA7XG4gIH1cblxuICByZXR1cm4gc2VsZWN0b3JTdHJpbmc7XG59XG4iXSwibmFtZXMiOlsiY29uc3RhbnRzIiwiY3NzVXRpbGl0aWVzIiwiZGVmYXVsdE1hcmtkb3duU3R5bGUiLCJESVZTX1NFTEVDVE9SX1NUUklORyIsImNsYXNzTmFtZUZyb21GaWxlUGF0aCIsInJlYWRGaWxlIiwicmVhZERpcmVjdG9yeSIsImlzRmlsZVBhdGhNYXJrZG93blN0eWxlRmlsZVBhdGgiLCJpc0ZpbGVQYXRoRGVmYXVsdE1hcmtkb3duU3R5bGVGaWxlUGF0aCIsIkNMSUVOVF9ESVZTX1NFTEVDVE9SX1NUUklORyIsImNzc0Zyb21NYXJrZG93blN0eWxlQW5kU2VsZWN0b3JTdHJpbmciLCJtYXJrZG93blN0eWxlc0NTU09wZXJhdGlvbiIsInByb2NlZWQiLCJhYm9ydCIsImNvbnRleHQiLCJjbGllbnQiLCJwcm9qZWN0RGlyZWN0b3J5TmFtZSIsInByb2plY3REaXJlY3RvcnlQYXRoIiwibWFya2Rvd25TdHlsZUZpbGVQYXRocyIsImZpbGVQYXRoIiwiZmlsZVBhdGhNYXJrZG93blN0eWxlRmlsZVBhdGgiLCJtYXJrZG93blN0eWxlRmlsZVBhdGgiLCJmaWxlUGF0aERlZmF1bHRNYXJrZG93blN0eWxlRmlsZVBhdGgiLCJ1bnNoaWZ0IiwicHVzaCIsInNlbGVjdG9yU3RyaW5nIiwibWFya2Rvd25TdHlsZSIsImRlZmF1bHRDU1MiLCJtYXJrZG93blN0eWxlc0NTUyIsImZvckVhY2giLCJzZWxlY3RvclN0cmluZ0Zyb21NYXJrZG93blN0eWxlRmlsZVBhdGhBbmRDbGllbnQiLCJtYXJrZG93blN0eWxlRnJvbU1hcmtkb3duU3R5bGVGaWxlUGF0aCIsImNzcyIsIk9iamVjdCIsImFzc2lnbiIsImNvbnRlbnQiLCJjbGFzc05hbWUiXSwibWFwcGluZ3MiOiJBQUFBO0FBRUEsU0FBU0EsU0FBUyxRQUFRLGtCQUFrQjtBQUM1QyxTQUFTQyxZQUFZLEVBQUVDLG9CQUFvQixRQUFRLG9CQUFvQjtBQUV2RSxTQUFTQyxvQkFBb0IsUUFBUSxlQUFlO0FBQ3BELFNBQVNDLHFCQUFxQixRQUFRLHdCQUF3QjtBQUM5RCxTQUFTQyxRQUFRLEVBQUVDLGFBQWEsUUFBUSwwQkFBMEI7QUFDbEUsU0FBU0MsK0JBQStCLEVBQUVDLHNDQUFzQyxRQUFRLHdCQUF3QjtBQUVoSCxJQUFRTCxBQUFzQk0sOEJBQWdDVCxVQUF0REcsc0JBQ0YsQUFBRU8sd0NBQTBDVCxhQUExQ1M7QUFFUixlQUFlLFNBQVNDLDJCQUEyQkMsT0FBTyxFQUFFQyxLQUFLLEVBQUVDLE9BQU87SUFDeEUsSUFBUUMsU0FBaUNELFFBQWpDQyxRQUFRQyx1QkFBeUJGLFFBQXpCRSxzQkFDVkMsdUJBQXVCRCxzQkFDdkJFLHlCQUF5QixFQUFFO0lBRWpDWixjQUFjVyxzQkFBc0IsU0FBQ0U7UUFDbkMsSUFBTUMsZ0NBQWdDYixnQ0FBZ0NZO1FBRXRFLElBQUlDLCtCQUErQjtZQUNqQyxJQUFNQyx3QkFBd0JGLFVBQ3hCRyx1Q0FBdUNkLHVDQUF1Q1c7WUFFcEZHLHVDQUNFSix1QkFBdUJLLE9BQU8sQ0FBQ0YseUJBQzdCSCx1QkFBdUJNLElBQUksQ0FBQ0g7UUFDbEM7SUFDRjtJQUVBLElBQU1JLGlCQUFpQlYsU0FDRU4sOEJBQ0VOLHNCQUNyQnVCLGdCQUFnQnhCLHNCQUNoQnlCLGFBQWFqQixzQ0FBc0NnQixlQUFlRDtJQUV4RSxJQUFJRyxvQkFBb0JELFlBQVksR0FBRztJQUV2Q1QsdUJBQXVCVyxPQUFPLENBQUMsU0FBQ1I7UUFDOUIsSUFBTUksaUJBQWlCSyxpREFBaURULHVCQUF1Qk4sU0FDekZXLGdCQUFnQkssdUNBQXVDVix3QkFDdkRXLE1BQU10QixzQ0FBc0NnQixlQUFlRCxnQkFBZ0JHLG9CQUFxQixHQUFHO1FBRXpHQSxvQkFBb0IsQUFBQyxHQUFzQkksT0FBcEJKLG1CQUF3QixPQUFKSTtJQUM3QztJQUVBQyxPQUFPQyxNQUFNLENBQUNwQixTQUFTO1FBQ3JCYyxtQkFBQUE7SUFDRjtJQUVBaEI7QUFDRjtBQUVBLFNBQVNtQix1Q0FBdUNWLHFCQUFxQjtJQUNuRSxJQUFNRixXQUFXRSx1QkFDWGMsVUFBVTlCLFNBQVNjLFdBQ25CTyxnQkFBZ0JTLFNBQVUsR0FBRztJQUVuQyxPQUFPVDtBQUNUO0FBRUEsU0FBU0ksaURBQWlEVCxxQkFBcUIsRUFBRU4sTUFBTTtJQUNyRixJQUFJVSxpQkFBaUJWLFNBQ0VOLDhCQUNFTjtJQUV6QixJQUFNZ0IsV0FBV0UsdUJBQ1hlLFlBQVloQyxzQkFBc0JlO0lBRXhDLElBQUlpQixjQUFjLE1BQU07UUFDdEJYLGlCQUFpQixBQUFDLEdBQW9CVyxPQUFsQlgsZ0JBQWUsS0FBYSxPQUFWVztJQUN4QztJQUVBLE9BQU9YO0FBQ1QifQ==