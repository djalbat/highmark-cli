"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return createHighmarkCSSOperation;
    }
});
var _highmarkclient = require("highmark-client");
var _highmarkmarkdown = require("highmark-markdown");
var _division = require("../utilities/division");
var _fileSystem = require("../utilities/fileSystem");
var _filePath = require("../utilities/filePath");
var cssFromMarkdownStyleAndCSSSelectorsString = _highmarkmarkdown.grammarUtilities.cssFromMarkdownStyleAndCSSSelectorsString, DIVS_CSS_SELECTORS_STRING = _highmarkclient.cssSelectorStrings.DIVS_CSS_SELECTORS_STRING, CLIENT_DIVS_CSS_SELECTOR_STRING = _highmarkclient.cssSelectorStrings.CLIENT_DIVS_CSS_SELECTOR_STRING;
function createHighmarkCSSOperation(proceed, abort, context) {
    var client = context.client, projectDirectoryName = context.projectDirectoryName, projectDirectoryPath = projectDirectoryName, markdownStyleFilePaths = [];
    (0, _fileSystem.readDirectory)(projectDirectoryPath, function(filePath) {
        var filePathMarkdownStyleFilePath = (0, _filePath.isFilePathMarkdownStyleFilePath)(filePath);
        if (filePathMarkdownStyleFilePath) {
            var markdownStyleFilePath = filePath, filePathDefaultMarkdownStyleFilePath = (0, _filePath.isFilePathDefaultMarkdownStyleFilePath)(filePath);
            filePathDefaultMarkdownStyleFilePath ? markdownStyleFilePaths.unshift(markdownStyleFilePath) : markdownStyleFilePaths.push(markdownStyleFilePath);
        }
    });
    var cssSelectorString = client ? CLIENT_DIVS_CSS_SELECTOR_STRING : DIVS_CSS_SELECTORS_STRING, markdownStyle = _highmarkmarkdown.defaultMarkdownStyle, css = cssFromMarkdownStyleAndCSSSelectorsString(markdownStyle, cssSelectorString);
    var highmarkCSS = css; ///
    markdownStyleFilePaths.forEach(function(markdownStyleFilePath) {
        var cssSelectorString = cssSelectorStringFromMarkdownStyleFilePathAndClient(markdownStyleFilePath, client), markdownStyle = markdownStyleFromMarkdownStyleFilePath(markdownStyleFilePath), css = cssFromMarkdownStyleAndCSSSelectorsString(markdownStyle, cssSelectorString); ///
        highmarkCSS = "".concat(highmarkCSS).concat(css);
    });
    Object.assign(context, {
        highmarkCSS: highmarkCSS
    });
    proceed();
}
function markdownStyleFromMarkdownStyleFilePath(markdownStyleFilePath) {
    var filePath = markdownStyleFilePath, content = (0, _fileSystem.readFile)(filePath), markdownStyle = content; ///
    return markdownStyle;
}
function cssSelectorStringFromMarkdownStyleFilePathAndClient(markdownStyleFilePath, client) {
    var cssSelectorString = client ? CLIENT_DIVS_CSS_SELECTOR_STRING : DIVS_CSS_SELECTORS_STRING;
    var filePath = markdownStyleFilePath, className = (0, _division.classNameFromFilePath)(filePath);
    if (className !== null) {
        cssSelectorString = "".concat(cssSelectorString, ".").concat(className);
    }
    return cssSelectorString;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9vcGVyYXRpb24vY3JlYXRlSGlnaG1hcmtDU1MuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB7IGNzc1NlbGVjdG9yU3RyaW5ncyB9IGZyb20gXCJoaWdobWFyay1jbGllbnRcIjtcbmltcG9ydCB7IGdyYW1tYXJVdGlsaXRpZXMsIGRlZmF1bHRNYXJrZG93blN0eWxlIH0gZnJvbSBcImhpZ2htYXJrLW1hcmtkb3duXCI7XG5cbmltcG9ydCB7IGNsYXNzTmFtZUZyb21GaWxlUGF0aCB9IGZyb20gXCIuLi91dGlsaXRpZXMvZGl2aXNpb25cIjtcbmltcG9ydCB7IHJlYWRGaWxlLCByZWFkRGlyZWN0b3J5IH0gZnJvbSBcIi4uL3V0aWxpdGllcy9maWxlU3lzdGVtXCI7XG5pbXBvcnQgeyBpc0ZpbGVQYXRoTWFya2Rvd25TdHlsZUZpbGVQYXRoLCBpc0ZpbGVQYXRoRGVmYXVsdE1hcmtkb3duU3R5bGVGaWxlUGF0aCB9IGZyb20gXCIuLi91dGlsaXRpZXMvZmlsZVBhdGhcIjtcblxuY29uc3QgeyBjc3NGcm9tTWFya2Rvd25TdHlsZUFuZENTU1NlbGVjdG9yc1N0cmluZyB9ID0gZ3JhbW1hclV0aWxpdGllcyxcbiAgICAgIHsgRElWU19DU1NfU0VMRUNUT1JTX1NUUklORywgQ0xJRU5UX0RJVlNfQ1NTX1NFTEVDVE9SX1NUUklORyB9ID0gY3NzU2VsZWN0b3JTdHJpbmdzO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjcmVhdGVIaWdobWFya0NTU09wZXJhdGlvbihwcm9jZWVkLCBhYm9ydCwgY29udGV4dCkge1xuICBjb25zdCB7IGNsaWVudCwgcHJvamVjdERpcmVjdG9yeU5hbWUgfSA9IGNvbnRleHQsXG4gICAgICAgIHByb2plY3REaXJlY3RvcnlQYXRoID0gcHJvamVjdERpcmVjdG9yeU5hbWUsICAvLy9cbiAgICAgICAgbWFya2Rvd25TdHlsZUZpbGVQYXRocyA9IFtdO1xuXG4gIHJlYWREaXJlY3RvcnkocHJvamVjdERpcmVjdG9yeVBhdGgsIChmaWxlUGF0aCkgPT4ge1xuICAgIGNvbnN0IGZpbGVQYXRoTWFya2Rvd25TdHlsZUZpbGVQYXRoID0gaXNGaWxlUGF0aE1hcmtkb3duU3R5bGVGaWxlUGF0aChmaWxlUGF0aCk7XG5cbiAgICBpZiAoZmlsZVBhdGhNYXJrZG93blN0eWxlRmlsZVBhdGgpIHtcbiAgICAgIGNvbnN0IG1hcmtkb3duU3R5bGVGaWxlUGF0aCA9IGZpbGVQYXRoLFxuICAgICAgICAgICAgZmlsZVBhdGhEZWZhdWx0TWFya2Rvd25TdHlsZUZpbGVQYXRoID0gaXNGaWxlUGF0aERlZmF1bHRNYXJrZG93blN0eWxlRmlsZVBhdGgoZmlsZVBhdGgpO1xuXG4gICAgICBmaWxlUGF0aERlZmF1bHRNYXJrZG93blN0eWxlRmlsZVBhdGggP1xuICAgICAgICBtYXJrZG93blN0eWxlRmlsZVBhdGhzLnVuc2hpZnQobWFya2Rvd25TdHlsZUZpbGVQYXRoKSA6XG4gICAgICAgICAgbWFya2Rvd25TdHlsZUZpbGVQYXRocy5wdXNoKG1hcmtkb3duU3R5bGVGaWxlUGF0aCk7XG4gICAgfVxuICB9KTtcblxuICBjb25zdCBjc3NTZWxlY3RvclN0cmluZyA9IGNsaWVudCA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDTElFTlRfRElWU19DU1NfU0VMRUNUT1JfU1RSSU5HIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRElWU19DU1NfU0VMRUNUT1JTX1NUUklORyxcbiAgICAgICAgbWFya2Rvd25TdHlsZSA9IGRlZmF1bHRNYXJrZG93blN0eWxlLCAvLy9cbiAgICAgICAgY3NzID0gY3NzRnJvbU1hcmtkb3duU3R5bGVBbmRDU1NTZWxlY3RvcnNTdHJpbmcobWFya2Rvd25TdHlsZSwgY3NzU2VsZWN0b3JTdHJpbmcpO1xuXG4gIGxldCBoaWdobWFya0NTUyA9IGNzczsgLy8vXG5cbiAgbWFya2Rvd25TdHlsZUZpbGVQYXRocy5mb3JFYWNoKChtYXJrZG93blN0eWxlRmlsZVBhdGgpID0+IHtcbiAgICBjb25zdCBjc3NTZWxlY3RvclN0cmluZyA9IGNzc1NlbGVjdG9yU3RyaW5nRnJvbU1hcmtkb3duU3R5bGVGaWxlUGF0aEFuZENsaWVudChtYXJrZG93blN0eWxlRmlsZVBhdGgsIGNsaWVudCksXG4gICAgICAgICAgbWFya2Rvd25TdHlsZSA9IG1hcmtkb3duU3R5bGVGcm9tTWFya2Rvd25TdHlsZUZpbGVQYXRoKG1hcmtkb3duU3R5bGVGaWxlUGF0aCksXG4gICAgICAgICAgY3NzID0gY3NzRnJvbU1hcmtkb3duU3R5bGVBbmRDU1NTZWxlY3RvcnNTdHJpbmcobWFya2Rvd25TdHlsZSwgY3NzU2VsZWN0b3JTdHJpbmcpOyAgLy8vXG5cbiAgICBoaWdobWFya0NTUyA9IGAke2hpZ2htYXJrQ1NTfSR7Y3NzfWA7XG4gIH0pO1xuXG4gIE9iamVjdC5hc3NpZ24oY29udGV4dCwge1xuICAgIGhpZ2htYXJrQ1NTXG4gIH0pO1xuXG4gIHByb2NlZWQoKTtcbn1cblxuZnVuY3Rpb24gbWFya2Rvd25TdHlsZUZyb21NYXJrZG93blN0eWxlRmlsZVBhdGgobWFya2Rvd25TdHlsZUZpbGVQYXRoKSB7XG4gIGNvbnN0IGZpbGVQYXRoID0gbWFya2Rvd25TdHlsZUZpbGVQYXRoLCAvLy9cbiAgICAgICAgY29udGVudCA9IHJlYWRGaWxlKGZpbGVQYXRoKSxcbiAgICAgICAgbWFya2Rvd25TdHlsZSA9IGNvbnRlbnQ7ICAvLy9cblxuICByZXR1cm4gbWFya2Rvd25TdHlsZTtcbn1cblxuZnVuY3Rpb24gY3NzU2VsZWN0b3JTdHJpbmdGcm9tTWFya2Rvd25TdHlsZUZpbGVQYXRoQW5kQ2xpZW50KG1hcmtkb3duU3R5bGVGaWxlUGF0aCwgY2xpZW50KSB7XG4gIGxldCBjc3NTZWxlY3RvclN0cmluZyA9IGNsaWVudCA/XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQ0xJRU5UX0RJVlNfQ1NTX1NFTEVDVE9SX1NUUklORyA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBESVZTX0NTU19TRUxFQ1RPUlNfU1RSSU5HO1xuXG4gIGNvbnN0IGZpbGVQYXRoID0gbWFya2Rvd25TdHlsZUZpbGVQYXRoLCAgLy8vXG4gICAgICAgIGNsYXNzTmFtZSA9IGNsYXNzTmFtZUZyb21GaWxlUGF0aChmaWxlUGF0aCk7XG5cbiAgaWYgKGNsYXNzTmFtZSAhPT0gbnVsbCkge1xuICAgIGNzc1NlbGVjdG9yU3RyaW5nID0gYCR7Y3NzU2VsZWN0b3JTdHJpbmd9LiR7Y2xhc3NOYW1lfWA7XG4gIH1cblxuICByZXR1cm4gY3NzU2VsZWN0b3JTdHJpbmc7XG59XG4iXSwibmFtZXMiOlsiY3JlYXRlSGlnaG1hcmtDU1NPcGVyYXRpb24iLCJjc3NGcm9tTWFya2Rvd25TdHlsZUFuZENTU1NlbGVjdG9yc1N0cmluZyIsImdyYW1tYXJVdGlsaXRpZXMiLCJESVZTX0NTU19TRUxFQ1RPUlNfU1RSSU5HIiwiY3NzU2VsZWN0b3JTdHJpbmdzIiwiQ0xJRU5UX0RJVlNfQ1NTX1NFTEVDVE9SX1NUUklORyIsInByb2NlZWQiLCJhYm9ydCIsImNvbnRleHQiLCJjbGllbnQiLCJwcm9qZWN0RGlyZWN0b3J5TmFtZSIsInByb2plY3REaXJlY3RvcnlQYXRoIiwibWFya2Rvd25TdHlsZUZpbGVQYXRocyIsInJlYWREaXJlY3RvcnkiLCJmaWxlUGF0aCIsImZpbGVQYXRoTWFya2Rvd25TdHlsZUZpbGVQYXRoIiwiaXNGaWxlUGF0aE1hcmtkb3duU3R5bGVGaWxlUGF0aCIsIm1hcmtkb3duU3R5bGVGaWxlUGF0aCIsImZpbGVQYXRoRGVmYXVsdE1hcmtkb3duU3R5bGVGaWxlUGF0aCIsImlzRmlsZVBhdGhEZWZhdWx0TWFya2Rvd25TdHlsZUZpbGVQYXRoIiwidW5zaGlmdCIsInB1c2giLCJjc3NTZWxlY3RvclN0cmluZyIsIm1hcmtkb3duU3R5bGUiLCJkZWZhdWx0TWFya2Rvd25TdHlsZSIsImNzcyIsImhpZ2htYXJrQ1NTIiwiZm9yRWFjaCIsImNzc1NlbGVjdG9yU3RyaW5nRnJvbU1hcmtkb3duU3R5bGVGaWxlUGF0aEFuZENsaWVudCIsIm1hcmtkb3duU3R5bGVGcm9tTWFya2Rvd25TdHlsZUZpbGVQYXRoIiwiT2JqZWN0IiwiYXNzaWduIiwiY29udGVudCIsInJlYWRGaWxlIiwiY2xhc3NOYW1lIiwiY2xhc3NOYW1lRnJvbUZpbGVQYXRoIl0sIm1hcHBpbmdzIjoiQUFBQTs7OzsrQkFZQTs7O2VBQXdCQTs7OzhCQVZXO2dDQUNvQjt3QkFFakI7MEJBQ0U7d0JBQ2dEO0FBRXhGLElBQU0sQUFBRUMsNENBQThDQyxrQ0FBZ0IsQ0FBOURELDJDQUNBRSw0QkFBK0RDLGtDQUFrQixDQUFqRkQsMkJBQTJCRSxrQ0FBb0NELGtDQUFrQixDQUF0REM7QUFFcEIsU0FBU0wsMkJBQTJCTSxPQUFPLEVBQUVDLEtBQUssRUFBRUMsT0FBTztJQUN4RSxJQUFRQyxTQUFpQ0QsUUFBakNDLFFBQVFDLHVCQUF5QkYsUUFBekJFLHNCQUNWQyx1QkFBdUJELHNCQUN2QkUseUJBQXlCLEVBQUU7SUFFakNDLElBQUFBLHlCQUFhLEVBQUNGLHNCQUFzQixTQUFDRztRQUNuQyxJQUFNQyxnQ0FBZ0NDLElBQUFBLHlDQUErQixFQUFDRjtRQUV0RSxJQUFJQywrQkFBK0I7WUFDakMsSUFBTUUsd0JBQXdCSCxVQUN4QkksdUNBQXVDQyxJQUFBQSxnREFBc0MsRUFBQ0w7WUFFcEZJLHVDQUNFTix1QkFBdUJRLE9BQU8sQ0FBQ0gseUJBQzdCTCx1QkFBdUJTLElBQUksQ0FBQ0o7UUFDbEM7SUFDRjtJQUVBLElBQU1LLG9CQUFvQmIsU0FDRUosa0NBQ0VGLDJCQUN4Qm9CLGdCQUFnQkMsc0NBQW9CLEVBQ3BDQyxNQUFNeEIsMENBQTBDc0IsZUFBZUQ7SUFFckUsSUFBSUksY0FBY0QsS0FBSyxHQUFHO0lBRTFCYix1QkFBdUJlLE9BQU8sQ0FBQyxTQUFDVjtRQUM5QixJQUFNSyxvQkFBb0JNLG9EQUFvRFgsdUJBQXVCUixTQUMvRmMsZ0JBQWdCTSx1Q0FBdUNaLHdCQUN2RFEsTUFBTXhCLDBDQUEwQ3NCLGVBQWVELG9CQUFxQixHQUFHO1FBRTdGSSxjQUFjLEFBQUMsR0FBZ0JELE9BQWRDLGFBQWtCLE9BQUpEO0lBQ2pDO0lBRUFLLE9BQU9DLE1BQU0sQ0FBQ3ZCLFNBQVM7UUFDckJrQixhQUFBQTtJQUNGO0lBRUFwQjtBQUNGO0FBRUEsU0FBU3VCLHVDQUF1Q1oscUJBQXFCO0lBQ25FLElBQU1ILFdBQVdHLHVCQUNYZSxVQUFVQyxJQUFBQSxvQkFBUSxFQUFDbkIsV0FDbkJTLGdCQUFnQlMsU0FBVSxHQUFHO0lBRW5DLE9BQU9UO0FBQ1Q7QUFFQSxTQUFTSyxvREFBb0RYLHFCQUFxQixFQUFFUixNQUFNO0lBQ3hGLElBQUlhLG9CQUFvQmIsU0FDRUosa0NBQ0VGO0lBRTVCLElBQU1XLFdBQVdHLHVCQUNYaUIsWUFBWUMsSUFBQUEsK0JBQXFCLEVBQUNyQjtJQUV4QyxJQUFJb0IsY0FBYyxNQUFNO1FBQ3RCWixvQkFBb0IsQUFBQyxHQUF1QlksT0FBckJaLG1CQUFrQixLQUFhLE9BQVZZO0lBQzlDO0lBRUEsT0FBT1o7QUFDVCJ9